<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Formulario Cables Especiales</title>
</head>
<body>
    <h1>Pedido de Cable Especial</h1>
    <form id="formCables">
        <label>Tipo de cable:
            <select name="tipoCable">
                <option value="A">Cable A</option>
                <option value="B">Cable B</option>
                <option value="C">Cable C</option>
            </select>
        </label>
        <br><br>

        <label>Capuchón:
            <select name="capuchon">
                <option value="capuchón rojo">Capuchón rojo</option>
                <option value="capuchón negro">Capuchón negro</option>
            </select>
        </label>
        <br><br>

        <label>Terminal:
            <select name="terminal">
                <option value="terminal tipo A">Terminal tipo A</option>
                <option value="terminal tipo B">Terminal tipo B</option>
            </select>
        </label>
        <br><br>

        <button type="button" id="btnEnviar">Generar Excel</button>
    </form>

    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script>
        // Diccionarios simples
        const traducciones = {
            cables: { "A": "CAB-A", "B": "CAB-B", "C": "CAB-C" },
            capuchones: { "capuchón rojo": "CAP-R", "capuchón negro": "CAP-N" },
            terminales: { "terminal tipo A": "TERM-A", "terminal tipo B": "TERM-B" }
        };

        // Reglas especiales de combinación
        const reglasCombinaciones = {
            "B|capuchón rojo|terminal tipo A": "COD-B-ROJO-A",
            "A|capuchón negro|terminal tipo B": "COD-A-NEGRO-B"
        };

        const btnEnviar = document.getElementById("btnEnviar");
        const form = document.getElementById("formCables");

        btnEnviar.addEventListener("click", function() {
            // 1️⃣ Datos cliente
            const datosCliente = {
                tipoCable: form.elements["tipoCable"].value,
                capuchon: form.elements["capuchon"].value,
                terminal: form.elements["terminal"].value
            };

            // 2️⃣ Datos técnicos
            const clave = `${datosCliente.tipoCable}|${datosCliente.capuchon}|${datosCliente.terminal}`;
            const codigoEspecial = reglasCombinaciones[clave] || "SIN-REGLA";

            const datosTecnicos = {
                tipoCable: traducciones.cables[datosCliente.tipoCable] || datosCliente.tipoCable,
                capuchon: traducciones.capuchones[datosCliente.capuchon] || datosCliente.capuchon,
                terminal: traducciones.terminales[datosCliente.terminal] || datosCliente.terminal,
                codigoFinal: codigoEspecial
            };

            // 3️⃣ Crear hoja con 2 filas
            const wb = XLSX.utils.book_new();
            const ws_data = [
                ["Cliente TipoCable","Cliente Capuchon","Cliente Terminal","Tecnico TipoCable","Tecnico Capuchon","Tecnico Terminal","Tecnico CodigoFinal"],
                [
                    datosCliente.tipoCable,
                    datosCliente.capuchon,
                    datosCliente.terminal,
                    datosTecnicos.tipoCable,
                    datosTecnicos.capuchon,
                    datosTecnicos.terminal,
                    datosTecnicos.codigoFinal
                ]
            ];

            const ws = XLSX.utils.aoa_to_sheet(ws_data);

            // 4️⃣ Sombrear la parte de datos técnicos en naranja
            const rango = XLSX.utils.decode_range(ws['!ref']);
            for(let C = 3; C <= 6; ++C){ // columnas D-G (0-index)
                const cell_address = {c:C, r:1}; // fila 2 (index 1)
                const cell_ref = XLSX.utils.encode_cell(cell_address);
                if(!ws[cell_ref]) continue;
                ws[cell_ref].s = {fill: {fgColor: {rgb: "FFFFA500"}}}; // naranja
            }

            XLSX.utils.book_append_sheet(wb, ws, "Pedido");
            XLSX.writeFile(wb, "pedido_completo.xlsx");
        });
    </script>
</body>
</html>
